#!/usr/bin/env perl

use warnings;
use strict;

my ($include_guard) = shift @ARGV;

my $now = scalar localtime;
my $files = join("\n      * ", @ARGV);

print <<"PREAMBLE";
#ifndef $include_guard
#define $include_guard
/* 
    Generated by $0 at $now, from
      * $files
*/
PREAMBLE

while (<>) {
    if (m/^\s*PRIMITIVE\s*\(\"[^"]+\",\s*[^,]+,\s*([^,]+),\s*[^,]+\s*\)\s*\{/) {
        print "void $1 ();\n";
    }
    elsif (m/^\s*VARIABLE\s*\(([^,]+),\s*[^,]+,\s*[^,]+,\s*[^,]+\s*\)\s*;/) {
        print "extern cell * const var_$1;\n";
    }
    elsif (m/^\s*CONSTANT\s*\(([^,]+),\s*[^,]+,\s*[^,]+,\s*[^,]+\s*\)\s*;/) {
        print "extern const cell * const const_$1;\n";
    }
    elsif (m/^\s*READONLY\s*\(([^,]+),\s*[^,]+,\s*[^,]+,\s*[^,]+\s*\)\s*;/) {
        print "void readonly_$1 ();\n";
    }
}

print <<"POSTAMBLE";
#endif /* $include_guard */
POSTAMBLE
